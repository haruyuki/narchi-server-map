var maxZoom=8,MAP_COORD_SCALE_FACTOR=256,showSpawn=!0,signsInitiallyVisible=!1,playersInitiallyVisible=!1,portalsInitiallyVisible=!1,bedsInitiallyVisible=!1,respawnAnchorsInitiallyVisible=!0,spawnInitiallyVisible=!0,viewsInitiallyVisible=!0,chestsInitiallyVisible=!1,beaconsInitiallyVisible=!1;let controlState={spawnControlChecked:spawnInitiallyVisible,signControlChecked:signsInitiallyVisible,viewControlChecked:viewsInitiallyVisible,playerControlChecked:playersInitiallyVisible,portalControlChecked:portalsInitiallyVisible,bedControlChecked:bedsInitiallyVisible,respawnAnchorControlChecked:respawnAnchorsInitiallyVisible,chestControlChecked:chestsInitiallyVisible,beaconControlChecked:beaconsInitiallyVisible};function createPlayerMarker(e,t){let o=L.icon({iconUrl:e.icon,iconAnchor:[17,20],popupAnchor:[0,-10]});return L.marker(t,{icon:o}).bindPopup(getPlayerHtml(e)).bindTooltip(e.name)}function getPlayerHtml(e){if("griffen8280"===e.name||"Vyruz"===e.name||"iamsofa"===e.name){let t="";t+="<center><table><tr>",t+="<td>",t+='<img src="Images/IronIcon.png"/>',t+="</td>",t+="<td>",t+='<a href="http://www.justgiving.com/tectonicus">Iron Supporter</a>',t+="</td>",t+="</tr></table></center>",e.donation=t}return'<div style="text-align:center"><div class="playerName" style="text-align:center; font-size:110%" >'+e.name+'</div><div style="width:300px; margin:4px;" ><img style="float:left; margin:4px;" src="'+e.icon+'" width="64" height="64" /><div><div>'+getHealthHtml(e)+"</div><div>"+getFoodHtml(e)+"</div><div>"+getAirHtml(e)+"</div><div>"+getInventoryHtml(e)+"</div><div>"+getItemsHtml(e)+'</div></div></div><div id="xpDiv" style="clear:both; text-align:center" >Experience level '+e.xpLevel+'</div><div id="donationDiv" style="clear:both; text-align:center" >'+getDonationHtml(e)+"</div></div>"}function getHealthHtml(e){for(var t,o="",n=0;n<10;n++)o+='<img style="margin:1px" src="'+(t=2*n+1<e.health?"Images/FullHeart.png":2*n<e.health?"Images/HalfHeart.png":"Images/EmptyHeart.png")+'" width="18" height="18" />';return o}function getFoodHtml(e){for(var t,o="",n=0;n<10;n++)o+='<img style="margin:1px" src="'+(t=2*n+1<e.food?"Images/FullFood.png":2*n<e.food?"Images/HalfFood.png":"Images/EmptyFood.png")+'" width="18" height="18" />';return o}function getAirHtml(e){for(var t,o="",n=0;n<10;n++)o+='<img style="margin:1px" src="'+(t=30*n<e.air?"Images/FullAir.png":"Images/EmptyAir.png")+'" width="18" height="18" />';return o}function getInventoryHtml(e){return""}function getItemsHtml(e){return""}function getDonationHtml(e){var t="";return t+="<div>",""!=e.donation?t+=e.donation:t+='<img src="Images/Spacer.png" style="height:38px;" />',t+="</div>"}function getUrlWithoutParams(){return(parts=window.location.href.split("?"))[0]}function getQueryParams(){for(var e,t={},o=/\+/g,n=/([^&;=]+)=?([^&;]*)/g,r=function(e){return decodeURIComponent(e.replace(o," "))},l=window.location.search.substring(1);e=n.exec(l);)t[r(e[1])]=r(e[2]);return t}function getFragmentParams(){for(var e,t={},o=/\+/g,n=/([^&;=]+)=?([^&;]*)/g,r=function(e){return decodeURIComponent(e.replace(o," "))},l=window.location.hash.substring(1);e=n.exec(l);)t[r(e[1])]=r(e[2]);return t}function CreateCompassControl(e){return new(L.Control.extend({options:{position:"topleft"},onAdd:function(t){var o=L.DomUtil.create("div","compass leaflet-control leaflet-control-custom");return o.style.background="url("+e+") center",o.style.backgroundSize="128px 128px",o.style.width="100px",o.style.height="80px",o}}))}function CreateToggleControl(e,t,o,n){return new(L.Control.extend({options:{position:"topright"},onAdd:function(r){let l=L.DomUtil.create("input","leaflet-bar leaflet-control leaflet-control-custom button");return l.type="image",l.src=t,l.title=e,l.style.padding="5px",l.style.width="34px",l.style.height="34px",l.checked=n,l.onclick=function(){for(i in this.checked=!this.checked,SetToggleBg(this),o){var t=o[i];this.checked?t.addTo(mymap):t.remove()}this.checked?this._tippy.setContent("Hide "+e):this._tippy.setContent("Show "+e)},L.DomEvent.disableClickPropagation(l),l},setChecked:function(e){let t=this._container;t.checked=e,SetToggleBg(t)}}))}function SetToggleBg(e){e.checked?e.style.backgroundColor="#CCCCFF":e.style.backgroundColor="#FFFFFF"}function MinecraftProjection(e){this.worldVectors=e}MinecraftProjection.prototype.worldToMap=function(e){let t=new L.Point(this.worldVectors.origin.x,this.worldVectors.origin.y);return t.x+=this.worldVectors.xAxis.x*e.x,t.y+=this.worldVectors.xAxis.y*e.x,this.worldVectors.yOffset>0?(t.x+=this.worldVectors.yAxis.x*(e.y+this.worldVectors.yOffset),t.y+=this.worldVectors.yAxis.y*(e.y+this.worldVectors.yOffset)):(t.x+=this.worldVectors.yAxis.x*e.y,t.y+=this.worldVectors.yAxis.y*e.y),t.x+=this.worldVectors.zAxis.x*e.z,t.y+=this.worldVectors.zAxis.y*e.z,[-(t.y/2),t.x/2]},MinecraftProjection.prototype.mapToWorld=function(e){let t=new L.Point(2*e.y,-2*e.x);t.x-=this.worldVectors.origin.x,t.y-=this.worldVectors.origin.y;let o=62;this.worldVectors.yOffset>0&&(o+=this.worldVectors.yOffset),t.x-=this.worldVectors.yAxis.x*o,t.y-=this.worldVectors.yAxis.y*o;let n=(t.x*this.worldVectors.zAxis.y-t.y*this.worldVectors.zAxis.x)/(this.worldVectors.xAxis.x*this.worldVectors.zAxis.y-this.worldVectors.zAxis.x*this.worldVectors.xAxis.y),r=(t.x*this.worldVectors.xAxis.y-t.y*this.worldVectors.xAxis.x)/(this.worldVectors.zAxis.x*this.worldVectors.xAxis.y-this.worldVectors.xAxis.x*this.worldVectors.zAxis.y);return new WorldCoord(n,o,r)};var localizations=null;const hiddenEnchantmentLevels=["aqua_affinity","binding_curse","channeling","flame","infinity","mending","multishot","silk_touch","vanishing_curse"],colorizedNames={beacon:"enchanted",conduit:"enchanted",creeper_head:"yellow",dragon_breath:"yellow",dragon_egg:"purple",dragon_head:"yellow",enchanted_book:"yellow",enchanted_golden_apple:"purple",end_crystal:"enchanted",experience_bottle:"yellow",golden_apple:"enchanted",heart_of_the_sea:"yellow",music_disc_11:"enchanted",music_disc_13:"enchanted",music_disc_5:"enchanted",music_disc_blocks:"enchanted",music_disc_cat:"enchanted",music_disc_chirp:"enchanted",music_disc_far:"enchanted",music_disc_mall:"enchanted",music_disc_mellohi:"enchanted",music_disc_otherside:"enchanted",music_disc_pigstep:"enchanted",music_disc_relic:"enchanted",music_disc_stal:"enchanted",music_disc_strad:"enchanted",music_disc_wait:"enchanted",music_disc_ward:"enchanted",nether_star:"yellow",piglin_head:"yellow",player_head:"yellow",skeleton_skull:"yellow",totem_of_undying:"yellow",wither_skeleton_skull:"yellow",zombie_head:"yellow"},potionColors={water:"#385dc6",mundane:"#385dc6",thick:"#385dc6",awkward:"#385dc6",night_vision:"#c2ff66",invisibility:"#f6f6f6",leaping:"#fdff84",fire_resistance:"#ff9900",swiftness:"#33ebff",slowness:"#8bafe0",water_breathing:"#98dac0",healing:"#f82423",harming:"#a9656a",poison:"#87a363",regeneration:"#cd5cab",strength:"#ffc700",weakness:"#484d48",luck:"#f7f8e0",turtle_master:"#8e7be8",slow_falling:"#f7f8e0"};async function containersMainAsync(){let e;try{e=await fetch("Scripts/localizations.json")}catch(t){console.error("There was a network error during localizations fetch. If the map is open directly from the file system, the problem was probably that the request was denied due to CORS policy.There is no way of overriding the browser CORS policy on Tectonicus side. Please host the map on web server.")}try{localizations=await e.json()}catch{console.error("Unable to parse localizations")}}function updateContainerItemTooltipPosition(e){let t=document.querySelector(".item:hover .item_description");if(t){let o=e.clientX,n=e.clientY,r=t.parentElement.getBoundingClientRect();t.style.top=(n-r.top-10)/3+"px",t.style.left=(o-r.left+20)/3+"px"}}function localize(e,t){return localizations&&localizations[e]?localizations[e]:(void 0===t&&(t=e),t)}function intToRoman(e){let t={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1},o="";for(let n in t)for(;e>=t[n];)o+=n,e-=t[n];return o}const charMap=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_'abcdefghijklmnopqrstuvwxyz{|}~",charWidths=["","!',.:;i|","`l",'"()*I[]t()',"<>fk"];function findCharacterRowAndColumn(e){let t=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_'abcdefghijklmnopqrstuvwxyz{|}~".indexOf(e);return -1===t?[15,3]:[t%16,Math.floor(t/16+2)]}function renderMinecraftText(e,t){if(!e)return null;t||(t="");let o='<div class="mc_text_container '+t+'">';for(let n=0;n<e.length;n++){let r=findCharacterRowAndColumn(e[n]),l=8*r[0],a=8*r[1],s="";for(let c=1;c<=4;c++)if(charWidths[c].indexOf(e[n])>=0){s=` width: ${c+1}px;`;break}o+=`<div class="mc_char" style="mask-position: -${l}px -${a}px;${s}"></div>`}return o+"</div>"}function createChestPopup(e){let t=e.large?'<div class="chest_container large"><div class="chest_scaler"><img src="Images/LargeChest.png" />':'<div class="chest_container"><div class="chest_scaler"><img src="Images/SmallChest.png" />';for(j in t+=renderMinecraftText(e.name,"chest_name"),e.items){let o=e.items[j],[n,r]=o.id.split(":"),l=`item.${n}.${r}.desc`,a=getItemName(o);a+=renderMinecraftText(localize(l,null)),a+=getTrimDescription(o),a+=getEnchantmentsDescription(o),a+=o.color?renderMinecraftText(localize("item.dyed"),"italic"):"";let s=Math.floor(o.slot/9),c=o.slot%9,d=18+18*s,g=8+18*c,p=getPngName(o,r);t+='<div class="item" style="top: '+d+"px; left: "+g+'px;">',t+='<img src="Images/Items/'+p+'.png" onload="checkImageSize(this)" />',t+=getColorLayer(o,r),t+=getOverlay(o,r,p),t+=getEnchantmentGlint(o,r,p),o.count>1&&(t+=renderMinecraftText(o.count.toString(),"item_count")),t+="<div class=item_description>"+a+"</div></div>"}return t+"</div></div>"}function getPngName(e,t){let o=t;if(e.trim){let[n,r]=e.trim.material.split(":");o+="_"+r+"_trim"}return o}function getItemName(e){let[t,o]=e.id.split(":"),n=`item.${t}.${o}`,r=`block.${t}.${o}`;if(e.components&&e.components.potionContents&&e.components.potionContents.potion){let[l,a]=e.components.potionContents.potion.split(":");n=`${n}.effect.${a.replace(/^(strong|long)_/,"")}`}let s="";if(e.enchantments&&(s=" enchanted"),colorizedNames[o]&&(s=" "+colorizedNames[o]),e.customName){let c=/{(text:(?<text>[^,)]*))?,?(translate:(?<translate>[^,)]*))?,?(color:(?<color>[^)]*))?}/.exec(e.customName);if(c){let{text:d,translate:g,color:p}=c.groups;return renderMinecraftText(localize(g,d),"name italic "+p+s)}return renderMinecraftText(localize(e.customName),"name italic"+s)}return renderMinecraftText(localize(n,localize(r,o)),"name"+s)}function getTrimDescription(e){let t="";if(e.trim){let[o,n]=e.trim.pattern.split(":"),[r,l]=e.trim.material.split(":"),a="Upgrade: ",s=`trim_pattern.${o}.${n}`,c=`trim_material.${r}.${l}`;a=localize("item.minecraft.smithing_template.upgrade",a),s=localize(s,n),c=localize(c,l),t+=renderMinecraftText(a),t+=renderMinecraftText(" "+s,l),t+=renderMinecraftText(" "+c,l)}return t}function getEnchantmentsDescription(e){let t="";if(e.enchantments)for(let o of e.enchantments){let n=o.id.indexOf("curse")>=0?"curse":"",[r,l]=o.id.split(":"),a=`enchantment.${r}.${l}`,s=localize(a,l),c="";0>hiddenEnchantmentLevels.indexOf(l)&&(c=" "+intToRoman(o.level)),t+=renderMinecraftText(s+c,n)}return t}function getEnchantmentGlint(e,t,o){return e.enchantments||"enchanted_golden_apple"===t?'<div class="enchanted_glint" style="-webkit-mask-image: url(\'Images/Items/'+o+".png'); mask-image: url('Images/Items/"+o+".png');\"></div>":""}function intToHTMLColor(e){if(!e)return null;for(var t=e.toString(16);t.length<6;)t="0"+t;return"#"+t}function getColorLayer(e,t){let o=intToHTMLColor(e?.color);if(e.components&&e.components.potionContents&&e.components.potionContents.potion){let n=e.components.potionContents.potion.replace(/^minecraft:((strong|long)_)?/,"");o=potionColors[n]?potionColors[n]:"#ff00ff"}return o||t.indexOf("leather_")>=0?'<div class="color_layer" style="background-color: '+(o??="rgb(106, 64, 41)")+"; mask-image: url('Images/Items/"+t+".png');\"></div>":""}function getOverlay(e,t,o){let n="";if("leather_boots"===t||"leather_chestplate"===t||"leather_helmet"===t||"leather_leggings"===t||t.indexOf("potion")>=0||"tipped_arrow"===t){let r=o+"_overlay";n+='<img src="Images/Items/'+r+'.png" />',n+=getEnchantmentGlint(e,r,r)}return n}function checkImageSize(e){(16!==e.naturalWidth||16!==e.naturalHeight)&&e.classList.add("item_3d")}let mymap=L.map("map",{crs:L.CRS.Simple,minZoom:0,maxZoom:maxZoom,attributionControl:!1}).setView([0,0],0),tileLayers=new Map,activeBaseLayer=null;function size(e){var t,o=0;for(t in e)e.hasOwnProperty(t)&&o++;return o}var layerControl=null,compassControl=null,viewToggleControl=null,signToggleControl=null,playerToggleControl=null,bedToggleControl=null,respawnAnchorToggleControl=null,beaconToggleControl=null,portalToggleControl=null,spawnToggleControl=null,chestToggleControl=null;async function mainAsync(){window.onmousemove=function(e){updateContainerItemTooltipPosition(e)};let e=containersMainAsync(),t=getQueryParams(),o=getFragmentParams();L.TileLayer.Tectonicus=L.TileLayer.extend({getTileUrl:function(e){let t=e.x%16,o=e.y%16;return this.mapId+"/"+this.layerId+"/Zoom"+e.z+"/"+t+"/"+o+"/tile_"+e.x+"_"+e.y+"."+this.imageFormat},getAttribution:function(){return'<a href="https://github.com/tectonicus/tectonicus">Tectonicus</a> - <a tabindex="0" id="mapInfo">'+this.mapName+"</a>"},initialize:function(e,t,o,n,r,l,a,s,c,d,g,p,h,m,y,f,u,C,w,b){this.mapId=e,this.layerId=t,this.dimension=o,this.imageFormat=n,this.mapName=r,this.backgroundColor=l,this.signs=a,this.players=s,this.chests=c,this.views=d,this.portals=g,this.beds=p,this.anchors=h,this.beacons=m,this.worldVectors=y,this.projection=f,this.blockStats=u,this.worldStats=C,this.viewPosition=w,this.controlState=JSON.parse(JSON.stringify(b))}});let n={};for(let r=0;r<contents.length;r++){let l=contents[r];for(let a=0;a<l.layers.length;a++){let s=l.layers[a],c=new MinecraftProjection(l.worldVectors),d=new ViewPos(s.id,l.worldVectors.startView,0,c.worldToMap(l.worldVectors.startView)),g=new L.TileLayer.Tectonicus(l.id,s.id,s.dimension,s.imageFormat,l.name,s.backgroundColor,l.signs,l.players,l.chests,l.views,l.portals,l.beds,l.respawnAnchors,l.beacons,l.worldVectors,c,l.blockStats,l.worldStats,d,controlState);n.hasOwnProperty(l.name+" - "+s.name)&&(s.name=s.name+r+a),n[l.name+" - "+s.name]=g,tileLayers.set(s.id,g)}}let p=tileLayers.get("LayerA"),h;h=size(o)>0?findStartView(o,p.layerId,p.viewPosition.worldPos):findStartView(t,p.layerId,p.viewPosition.worldPos);let m=tileLayers.get(h.layerId);activeBaseLayer=m,m.addTo(mymap),mymap.setView(h.startPoint,h.zoom),m.viewPosition=h,tileLayers.size>1&&(layerControl=L.control.layers(n)),compassControl=CreateCompassControl(m.mapId+"/Compass.png"),viewToggleControl=CreateToggleControl("views","Images/Picture.png",viewMarkers,viewsInitiallyVisible),signToggleControl=CreateToggleControl("signs","Images/Sign.png",signMarkers,signsInitiallyVisible),playerToggleControl=CreateToggleControl("players","Images/PlayerIcons/Tectonicus_Default_Player_Icon.png",playerMarkers,playersInitiallyVisible),bedToggleControl=CreateToggleControl("beds","Images/Bed.png",bedMarkers,bedsInitiallyVisible),respawnAnchorToggleControl=CreateToggleControl("respawn anchors","Images/RespawnAnchor.png",respawnAnchorMarkers,respawnAnchorsInitiallyVisible),beaconToggleControl=CreateToggleControl("beacons","Images/beacon.png",beaconMarkers,beaconsInitiallyVisible),portalToggleControl=CreateToggleControl("portals","Images/Portal.png",portalMarkers,portalsInitiallyVisible),spawnToggleControl=CreateToggleControl("spawn","Images/Spawn.png",spawnMarkers,spawnInitiallyVisible),chestToggleControl=CreateToggleControl("chests","Images/Chest.png",chestMarkers,chestsInitiallyVisible),L.control.attribution({position:"bottomleft"}).setPrefix('<a href="http://www.leafletjs.com">Leaflet</a>').addTo(mymap),await e,mymap.on("baselayerchange",onBaseLayerChange),mymap.on("zoomend",onProjectionChanged),mymap.on("moveend",onProjectionChanged),mymap.fireEvent("baselayerchange",{layer:m})}function onBaseLayerChange(e){spawnToggleControl.hasOwnProperty("_container")&&(controlState.spawnControlChecked=spawnToggleControl._container.checked),signToggleControl.hasOwnProperty("_container")&&(controlState.signControlChecked=signToggleControl._container.checked),viewToggleControl.hasOwnProperty("_container")&&(controlState.viewControlChecked=viewToggleControl._container.checked),playerToggleControl.hasOwnProperty("_container")&&(controlState.playerControlChecked=playerToggleControl._container.checked),portalToggleControl.hasOwnProperty("_container")&&(controlState.portalControlChecked=portalToggleControl._container.checked),bedToggleControl.hasOwnProperty("_container")&&(controlState.bedControlChecked=bedToggleControl._container.checked),respawnAnchorToggleControl.hasOwnProperty("_container")&&(controlState.respawnAnchorControlChecked=respawnAnchorToggleControl._container.checked),beaconToggleControl.hasOwnProperty("_container")&&(controlState.beaconControlChecked=beaconToggleControl._container.checked),chestToggleControl.hasOwnProperty("_container")&&(controlState.chestControlChecked=chestToggleControl._container.checked),activeBaseLayer.controlState=JSON.parse(JSON.stringify(controlState)),activeBaseLayer=e.layer,controlState=e.layer.controlState,mymap.setView(e.layer.viewPosition.startPoint,e.layer.viewPosition.zoom),changeBackgroundColor(e.layer.backgroundColor),spawnToggleControl.remove(),e.layer.worldVectors.hasOwnProperty("spawnPosition")&&"NETHER"!==e.layer.dimension&&(mymap.addControl(spawnToggleControl),spawnToggleControl.setChecked(controlState.spawnControlChecked)),signToggleControl.remove(),0!=e.layer.signs.length&&(mymap.addControl(signToggleControl),signToggleControl.setChecked(controlState.signControlChecked)),viewToggleControl.remove(),0!=e.layer.views.length&&(mymap.addControl(viewToggleControl),viewToggleControl.setChecked(controlState.viewControlChecked)),playerToggleControl.remove(),0!=e.layer.players.length&&(mymap.addControl(playerToggleControl),playerToggleControl.setChecked(controlState.playerControlChecked)),portalToggleControl.remove(),0!=e.layer.portals.length&&(mymap.addControl(portalToggleControl),portalToggleControl.setChecked(controlState.portalControlChecked)),bedToggleControl.remove(),0!=e.layer.beds.length&&(mymap.addControl(bedToggleControl),bedToggleControl.setChecked(controlState.bedControlChecked)),respawnAnchorToggleControl.remove(),0!=e.layer.anchors.length&&(mymap.addControl(respawnAnchorToggleControl),respawnAnchorToggleControl.setChecked(controlState.respawnAnchorControlChecked)),beaconToggleControl.remove(),0!=e.layer.beacons.length&&(mymap.addControl(beaconToggleControl),beaconToggleControl.setChecked(controlState.beaconControlChecked)),chestToggleControl.remove(),0!=e.layer.chests.length&&(mymap.addControl(chestToggleControl),chestToggleControl.setChecked(controlState.chestControlChecked)),null!=layerControl&&mymap.addControl(layerControl),tippy(".button",{content(e){let t=e.getAttribute("title");return(e.removeAttribute("title"),e.checked)?"Hide "+t:"Show "+t},placement:"left",theme:"light"}),"NETHER"===e.layer.dimension?destroyMarkers(spawnMarkers):refreshSpawnMarker(e.layer,controlState.spawnControlChecked),refreshSignMarkers(e.layer,controlState.signControlChecked),refreshViewMarkers(e.layer,controlState.viewControlChecked),refreshPlayerMarkers(e.layer,controlState.playerControlChecked),refreshPortalMarkers(e.layer,controlState.portalControlChecked),refreshBedMarkers(e.layer,controlState.bedControlChecked),refreshRespawnAnchorMarkers(e.layer,controlState.respawnAnchorControlChecked),refreshBeaconMarkers(e.layer,controlState.beaconControlChecked),refreshChestMarkers(e.layer,controlState.chestControlChecked),compassControl.remove(),compassControl=CreateCompassControl(e.layer.mapId+"/Compass.png"),mymap.addControl(compassControl);let t=stats.peakMemoryBytes/1024/1024,o="";o+='<h4 class="center">Map Info</h4>',o+='<div class="center">Render Stats</div>',o+="Tectonicus version: "+stats.tectonicusVersion+"<br/>",o+="Render time: "+stats.renderTime+"<br/>",o+="Peak memory usage: "+t.toFixed(1)+"Mb<br/>",o+="Created on "+stats.renderedOnDate+"<br/>",o+="Created at "+stats.renderedOnTime+"<br/>",o+="<br/>",o+='<div class="center">World stats</div>',o+="Players: "+e.layer.worldStats.numPlayers+"<br/>",o+="Chunks: "+e.layer.worldStats.numChunks+"<br/>",o+="Portals: "+e.layer.worldStats.numPortals+"<br/>",o+="Views: "+e.layer.views.length+"<br/>",o+="Signs: "+e.layer.signs.length+"<br/>",tippy("#mapInfo",{content:o+="Player Beds: "+e.layer.beds.length+"<br/>",allowHTML:!0,interactive:!0,theme:"light",maxWidth:500})}function changeBackgroundColor(e){document.querySelector("#map").style.backgroundColor=e}function onProjectionChanged(e){activeBaseLayer.viewPosition.startPoint=mymap.getCenter(),activeBaseLayer.viewPosition.zoom=mymap.getZoom()}function refreshSpawnMarker(e,t){if(destroyMarkers(spawnMarkers),showSpawn&&e.worldVectors.hasOwnProperty("spawnPosition")){let o=e.projection.worldVectors.spawnPosition,n=e.projection.worldToMap(o),r=L.icon({iconUrl:"Images/Spawn.png",iconAnchor:[17,20],popupAnchor:[0,-10]}),l=L.marker(n,{icon:r}).bindPopup('<p class="center">'+o.x+", "+o.y+", "+o.z+"</p>").bindTooltip("Spawn Point");t&&l.addTo(mymap),spawnMarkers.push(l)}}function refreshSignMarkers(e,t){for(i in destroyMarkers(signMarkers),e.signs){let o=e.signs[i],n=e.projection.worldToMap(o.worldPos),r=L.icon({iconUrl:"Images/Sign.png",iconAnchor:[17,20],popupAnchor:[0,-10]}),l=L.marker(n,{icon:r}).bindPopup("<pre><center>"+o.text1+"<br/>"+o.text2+"<br/>"+o.text3+"<br/>"+o.text4+"</center></pre>");t&&l.addTo(mymap),signMarkers.push(l)}}function refreshViewMarkers(e,t){for(i in destroyMarkers(viewMarkers),e.views){let o=e.views[i],n=e.projection.worldToMap(o.worldPos),r=L.icon({iconUrl:"Images/Picture.png",iconAnchor:[17,20],popupAnchor:[0,-10]}),l="";l+="<div>",l+='<a href="'+o.imageFile+'">',l+='<img width="512" height="288" src="'+o.imageFile+'"/>',l+="</a>",l+="</div>",l+="",l+="<center>",l+=o.text,l+="</center>",l+="";let a=L.marker(n,{icon:r}).bindPopup(l,{maxWidth:"auto"});t&&a.addTo(mymap),viewMarkers.push(a)}}function loadIcon(e,t,o,n){var r=new Image;r.onload=function(){t.icon=e;var r=createPlayerMarker(t,o);n&&r.addTo(mymap),playerMarkers.push(r)},r.onerror=function(){t.icon=t.icon="Images/PlayerIcons/Tectonicus_Default_Player_Icon.png";var e=createPlayerMarker(t,o);n&&e.addTo(mymap),playerMarkers.push(e)},r.src=e}function refreshPlayerMarkers(e,t){for(i in destroyMarkers(playerMarkers),e.players){let o=e.players[i];o.donation="";let n=e.projection.worldToMap(o.worldPos);loadIcon("Images/PlayerIcons/"+o.name+".png",o,n,t)}}function refreshBedMarkers(e,t){for(i in destroyMarkers(bedMarkers),e.beds){let o=e.beds[i],n=e.projection.worldToMap(o.worldPos),r=L.icon({iconUrl:"Images/Items/"+o.color+"_bed.png",iconAnchor:[25,30],popupAnchor:[0,-10]}),l=L.marker(n,{icon:r}).bindPopup('<p class="center">'+o.playerName+"'s bed</p>");t&&l.addTo(mymap),bedMarkers.push(l)}}function refreshRespawnAnchorMarkers(e,t){for(i in destroyMarkers(respawnAnchorMarkers),e.anchors){let o=e.anchors[i],n=e.projection.worldToMap(o.worldPos),r=L.icon({iconUrl:"Images/RespawnAnchor.png",iconAnchor:[17,20],popupAnchor:[0,-10]}),l=L.marker(n,{icon:r}).bindPopup('<p class="center">'+o.playerName+"'s respawn anchor</p>");t&&l.addTo(mymap),respawnAnchorMarkers.push(l)}}function refreshBeaconMarkers(e,t){for(i in destroyMarkers(beaconMarkers),e.beacons){let o=e.beacons[i],n=e.projection.worldToMap(o.worldPos),r=L.icon({iconUrl:"Images/beacon.png",iconAnchor:[17,20],popupAnchor:[0,-10]}),l;if(o.levels>0){let a="none"!==o.primaryEffect?localize("effect.minecraft."+o.primaryEffect):"None",s="none"!==o.secondaryEffect?localize("effect.minecraft."+o.secondaryEffect):"None";l=L.marker(n,{icon:r}).bindPopup(`<p style="width:230px; height:64px"><img style="float:left; margin:4px;" src="Images/beacon_level_${parseInt(o.levels)}.png" width="64" height="64" />
		        Primary Power:<br /><img style="padding-right:4px; vertical-align:middle" src="Images/effects/${o.primaryEffect}.png" />${a}<br />
		        Secondary Power:<br /><img style="padding-right:4px; vertical-align:middle" src="Images/effects/${o.secondaryEffect}.png" />${s}</p>`)}else l=L.marker(n,{icon:r}).bindPopup('<p class="center">Not Activated</p>');t&&l.addTo(mymap),beaconMarkers.push(l)}}function refreshPortalMarkers(e,t){for(i in destroyMarkers(portalMarkers),e.portals){let o=e.portals[i],n=e.projection.worldToMap(o.worldPos),r=L.icon({iconUrl:"Images/Portal.png",iconAnchor:[17,20],popupAnchor:[0,-10]}),l=L.marker(n,{icon:r}).bindPopup('<div style="text-align:center">Portal</div><br/> position ('+o.worldPos.x+", "+o.worldPos.y+", "+o.worldPos.z+")");t&&l.addTo(mymap),portalMarkers.push(l)}}function refreshChestMarkers(e,t){for(i in destroyMarkers(chestMarkers),e.chests){let o=e.projection.worldToMap(e.chests[i].worldPos),n=L.icon({iconUrl:"Images/Chest.png",iconAnchor:[17,20],popupAnchor:[0,-10]}),r=createChestPopup(e.chests[i]),l=L.marker(o,{icon:n}).bindPopup(r,{maxWidth:"auto"});t&&l.addTo(mymap),chestMarkers.push(l)}}function destroyMarkers(e){for(i in e)e[i].remove();e.length=0}function ViewPos(e,t,o,n){this.layerId=e,this.worldPos=t,this.zoom=o,this.startPoint=n}function findStartView(e,t,o){let n=t,r=new WorldCoord(o.x,o.y,o.z),l=0;e.hasOwnProperty("layerId")&&(n=e.layerId),e.hasOwnProperty("worldX")&&e.hasOwnProperty("worldY")&&e.hasOwnProperty("worldZ")&&(r.x=parseInt(e.worldX),r.y=parseInt(e.worldY),r.z=parseInt(e.worldZ)),e.hasOwnProperty("zoom")&&(l=parseInt(e.zoom)),l<0&&(l=0),l>maxZoom&&(l=maxZoom);let a=tileLayers.get(n).projection.worldToMap(r);return new ViewPos(n,r,l,a)}spawnMarkers=[],signMarkers=[],viewMarkers=[],playerMarkers=[],portalMarkers=[],bedMarkers=[],respawnAnchorMarkers=[],beaconMarkers=[],chestMarkers=[],window.onload=mainAsync;